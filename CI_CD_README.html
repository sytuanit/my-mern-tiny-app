<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>CI&sol;CD Pipeline v&#x1edb;i Terraform Provisioning</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="cicd-pipeline-vá»›i-terraform-provisioning">CI/CD Pipeline vá»›i Terraform Provisioning</h1>
<p>Há»‡ thá»‘ng CI/CD tá»± Ä‘á»™ng hÃ³a toÃ n bá»™ quy trÃ¬nh tá»« build, test, Ä‘áº¿n deploy infrastructure vÃ  applications lÃªn LocalStack sá»­ dá»¥ng Terraform.</p>
<h2 id="-tá»•ng-quan">ğŸ“‹ Tá»•ng quan</h2>
<p>Pipeline nÃ y bao gá»“m cÃ¡c bÆ°á»›c:</p>
<ol>
<li><strong>Code Quality</strong>: Lint vÃ  format code</li>
<li><strong>Build</strong>: Build á»©ng dá»¥ng vÃ  Docker images</li>
<li><strong>Test</strong>: Cháº¡y unit tests (náº¿u cÃ³)</li>
<li><strong>Infrastructure Provisioning</strong>: Sá»­ dá»¥ng Terraform Ä‘á»ƒ táº¡o VPC, EC2, Security Groups, etc.</li>
<li><strong>Deploy</strong>: Deploy applications lÃªn EC2 instances</li>
<li><strong>Health Checks</strong>: Kiá»ƒm tra health cá»§a cÃ¡c services</li>
</ol>
<h2 id="-cÃ¡ch-sá»­-dá»¥ng">ğŸš€ CÃ¡ch sá»­ dá»¥ng</h2>
<h3 id="option-1-powershell-script-windows---recommended">Option 1: PowerShell Script (Windows - Recommended)</h3>
<p>Cháº¡y toÃ n bá»™ pipeline:</p>
<pre><code class="language-powershell">.\scripts\cicd<span class="hljs-literal">-local</span>.ps1
</code></pre>
<p>Vá»›i cÃ¡c options:</p>
<pre><code class="language-powershell"><span class="hljs-comment"># Bá» qua tests</span>
.\scripts\cicd<span class="hljs-literal">-local</span>.ps1 <span class="hljs-literal">-SkipTests</span>

<span class="hljs-comment"># Bá» qua linting</span>
.\scripts\cicd<span class="hljs-literal">-local</span>.ps1 <span class="hljs-literal">-SkipLint</span>

<span class="hljs-comment"># Cáº£ hai</span>
.\scripts\cicd<span class="hljs-literal">-local</span>.ps1 <span class="hljs-literal">-SkipTests</span> <span class="hljs-literal">-SkipLint</span>
</code></pre>
<h3 id="option-2-makefile-linuxmacwindows-with-make">Option 2: Makefile (Linux/Mac/Windows with Make)</h3>
<pre><code class="language-bash"><span class="hljs-comment"># Cháº¡y toÃ n bá»™ CI/CD pipeline</span>
make cicd

<span class="hljs-comment"># Hoáº·c tá»«ng bÆ°á»›c riÃªng láº»</span>
make build              <span class="hljs-comment"># Build Docker images</span>
make terraform-init     <span class="hljs-comment"># Initialize Terraform</span>
make terraform-plan     <span class="hljs-comment"># Plan Terraform deployment</span>
make terraform-apply    <span class="hljs-comment"># Apply Terraform configuration</span>
make health-check       <span class="hljs-comment"># Check application health</span>
</code></pre>
<h3 id="option-3-github-actions-cloud-cicd">Option 3: GitHub Actions (Cloud CI/CD)</h3>
<p>Pipeline tá»± Ä‘á»™ng cháº¡y khi:</p>
<ul>
<li>Push code lÃªn <code>main</code> hoáº·c <code>develop</code> branch</li>
<li>Táº¡o Pull Request</li>
<li>Manual trigger tá»« GitHub Actions tab</li>
</ul>
<p>Workflow file: <code>.github/workflows/cicd-localstack.yml</code></p>
<h2 id="-cáº¥u-trÃºc-files">ğŸ“ Cáº¥u trÃºc Files</h2>
<pre><code>.
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ cicd-localstack.yml    # GitHub Actions workflow
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ cicd-local.ps1              # PowerShell CI/CD script
â”‚   â”œâ”€â”€ health-check.ps1           # Health check script
â”‚   â””â”€â”€ validate-terraform.ps1     # Terraform validation script
â”œâ”€â”€ terraform/
â”‚   â””â”€â”€ localstack/
â”‚       â”œâ”€â”€ main.tf                # Terraform configuration
â”‚       â”œâ”€â”€ variables.tf           # Terraform variables
â”‚       â””â”€â”€ outputs.tf             # Terraform outputs
â””â”€â”€ Makefile                       # Makefile commands
</code></pre>
<h2 id="-cÃ¡c-commands-cÃ³-sáºµn">ğŸ”§ CÃ¡c Commands cÃ³ sáºµn</h2>
<h3 id="powershell-scripts">PowerShell Scripts</h3>
<table>
<thead>
<tr>
<th>Script</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cicd-local.ps1</code></td>
<td>Cháº¡y toÃ n bá»™ CI/CD pipeline</td>
</tr>
<tr>
<td><code>health-check.ps1</code></td>
<td>Kiá»ƒm tra health cá»§a táº¥t cáº£ services</td>
</tr>
<tr>
<td><code>validate-terraform.ps1</code></td>
<td>Validate vÃ  format Terraform config</td>
</tr>
</tbody>
</table>
<h3 id="makefile-commands">Makefile Commands</h3>
<table>
<thead>
<tr>
<th>Command</th>
<th>MÃ´ táº£</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>make cicd</code></td>
<td>Cháº¡y toÃ n bá»™ CI/CD pipeline</td>
</tr>
<tr>
<td><code>make cicd-local</code></td>
<td>Cháº¡y PowerShell CI/CD script</td>
</tr>
<tr>
<td><code>make build</code></td>
<td>Build Docker images</td>
</tr>
<tr>
<td><code>make localstack-up</code></td>
<td>Start LocalStack vÃ  infrastructure</td>
</tr>
<tr>
<td><code>make terraform-init</code></td>
<td>Initialize Terraform</td>
</tr>
<tr>
<td><code>make terraform-plan</code></td>
<td>Plan Terraform deployment</td>
</tr>
<tr>
<td><code>make terraform-apply</code></td>
<td>Apply Terraform configuration</td>
</tr>
<tr>
<td><code>make terraform-validate</code></td>
<td>Validate Terraform config</td>
</tr>
<tr>
<td><code>make terraform-fmt</code></td>
<td>Format Terraform files</td>
</tr>
<tr>
<td><code>make terraform-destroy</code></td>
<td>Destroy infrastructure</td>
</tr>
<tr>
<td><code>make health-check</code></td>
<td>Check application health</td>
</tr>
<tr>
<td><code>make list-instances</code></td>
<td>List EC2 instances trong LocalStack</td>
</tr>
</tbody>
</table>
<h2 id="-pipeline-steps-chi-tiáº¿t">ğŸ“Š Pipeline Steps Chi tiáº¿t</h2>
<h3 id="1-pre-flight-checks">1. Pre-flight Checks</h3>
<ul>
<li>Kiá»ƒm tra Docker, Terraform, Node.js Ä‘Ã£ cÃ i Ä‘áº·t</li>
<li>Kiá»ƒm tra Docker daemon Ä‘ang cháº¡y</li>
<li>Kiá»ƒm tra LocalStack Ä‘ang cháº¡y</li>
</ul>
<h3 id="2-code-quality">2. Code Quality</h3>
<ul>
<li>Lint code (API, Consumer, UI)</li>
<li>Format code (náº¿u cÃ³ linter)</li>
</ul>
<h3 id="3-build">3. Build</h3>
<ul>
<li>Install dependencies (<code>npm ci</code>)</li>
<li>Build TypeScript (<code>npm run build</code>)</li>
<li>Build Docker images</li>
</ul>
<h3 id="4-test">4. Test</h3>
<ul>
<li>Cháº¡y unit tests (náº¿u cÃ³)</li>
<li>CÃ³ thá»ƒ bá» qua vá»›i <code>-SkipTests</code></li>
</ul>
<h3 id="5-infrastructure-setup">5. Infrastructure Setup</h3>
<ul>
<li>Start LocalStack (náº¿u chÆ°a cháº¡y)</li>
<li>Start MongoDB, Kafka, Zookeeper</li>
<li>Äá»£i services ready</li>
</ul>
<h3 id="6-terraform-provisioning">6. Terraform Provisioning</h3>
<ul>
<li><code>terraform init</code> - Initialize Terraform</li>
<li><code>terraform fmt</code> - Format code</li>
<li><code>terraform validate</code> - Validate configuration</li>
<li><code>terraform plan</code> - Plan deployment</li>
<li><code>terraform apply</code> - Apply infrastructure</li>
</ul>
<h3 id="7-health-checks">7. Health Checks</h3>
<ul>
<li>Kiá»ƒm tra API health endpoint</li>
<li>Kiá»ƒm tra Consumer health endpoint</li>
<li>Kiá»ƒm tra UI health endpoint (náº¿u cÃ³)</li>
</ul>
<h3 id="8-verification">8. Verification</h3>
<ul>
<li>Verify LocalStack resources (EC2 instances)</li>
<li>Show deployment summary</li>
</ul>
<h2 id="-health-check-endpoints">ğŸ” Health Check Endpoints</h2>
<p>Pipeline kiá»ƒm tra cÃ¡c endpoints sau:</p>
<ul>
<li>API: <code>http://localhost:3000/health</code> hoáº·c <code>http://localhost:3000/api/health</code></li>
<li>Consumer: <code>http://localhost:3001/health</code> hoáº·c <code>http://localhost:3001/api/health</code></li>
<li>UI: <code>http://localhost:3002/health</code> hoáº·c <code>http://localhost:3002/api/health</code></li>
<li>LocalStack: <code>http://localhost:4567/_localstack/health</code></li>
</ul>
<h2 id="ï¸-terraform-variables">ğŸ› ï¸ Terraform Variables</h2>
<p>CÃ¡c biáº¿n Terraform Ä‘Æ°á»£c sá»­ dá»¥ng:</p>
<pre><code class="language-hcl">docker_registry = &quot;localhost&quot;  # Docker registry URL
mongodb_uri     = &quot;mongodb://mongodb:27017/my-tiny-app&quot;
kafka_broker    = &quot;kafka:9093&quot;
app_api_url     = &quot;http://app:3000&quot;
</code></pre>
<p>CÃ³ thá»ƒ override trong <code>terraform/localstack/terraform.tfvars</code> hoáº·c pass qua command line.</p>
<h2 id="-troubleshooting">ğŸ› Troubleshooting</h2>
<h3 id="localstack-khÃ´ng-cháº¡y">LocalStack khÃ´ng cháº¡y</h3>
<pre><code class="language-powershell">docker<span class="hljs-literal">-compose</span> <span class="hljs-operator">-f</span> docker<span class="hljs-literal">-compose</span>.localstack.yml up <span class="hljs-literal">-d</span> localstack
</code></pre>
<h3 id="terraform-init-failed">Terraform init failed</h3>
<pre><code class="language-powershell"><span class="hljs-built_in">cd</span> terraform/localstack
terraform init
</code></pre>
<h3 id="health-check-failed">Health check failed</h3>
<ul>
<li>Kiá»ƒm tra services Ä‘Ã£ start chÆ°a: <code>docker ps</code></li>
<li>Kiá»ƒm tra logs: <code>docker logs localstack</code></li>
<li>Äá»£i thÃªm thá»i gian (services cáº§n thá»i gian khá»Ÿi Ä‘á»™ng)</li>
</ul>
<h3 id="terraform-format-issues">Terraform format issues</h3>
<pre><code class="language-powershell"><span class="hljs-built_in">cd</span> terraform/localstack
terraform fmt
</code></pre>
<h2 id="-environment-variables">ğŸ“ Environment Variables</h2>
<p>CÃ³ thá»ƒ set cÃ¡c biáº¿n mÃ´i trÆ°á»ng:</p>
<pre><code class="language-powershell"><span class="hljs-variable">$env:DOCKER_REGISTRY</span> = <span class="hljs-string">&quot;localhost&quot;</span>
<span class="hljs-variable">$env:MONGODB_URI</span> = <span class="hljs-string">&quot;mongodb://mongodb:27017/my-tiny-app&quot;</span>
<span class="hljs-variable">$env:KAFKA_BROKER</span> = <span class="hljs-string">&quot;kafka:9093&quot;</span>
</code></pre>
<h2 id="-security-notes">ğŸ” Security Notes</h2>
<ul>
<li>Scripts sá»­ dá»¥ng LocalStack vá»›i credentials test (<code>test/test</code>)</li>
<li>KhÃ´ng dÃ¹ng cho production</li>
<li>Terraform state file Ä‘Æ°á»£c lÆ°u local (<code>terraform.tfstate</code>)</li>
</ul>
<h2 id="-tÃ i-liá»‡u-tham-kháº£o">ğŸ“š TÃ i liá»‡u tham kháº£o</h2>
<ul>
<li><a href="https://www.terraform.io/docs">Terraform Documentation</a></li>
<li><a href="https://docs.localstack.cloud/">LocalStack Documentation</a></li>
<li><a href="https://docs.github.com/en/actions">GitHub Actions Documentation</a></li>
</ul>
<h2 id="-next-steps">ğŸ¯ Next Steps</h2>
<ol>
<li>ThÃªm unit tests vÃ o pipeline</li>
<li>ThÃªm integration tests</li>
<li>Setup remote Terraform state (S3 backend)</li>
<li>ThÃªm notification (Slack, Email)</li>
<li>ThÃªm rollback mechanism</li>
<li>Setup multi-environment (dev, staging, prod)</li>
</ol>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>