<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>LocalStack EC2 Deployment Guide</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="localstack-ec2-deployment-guide">LocalStack EC2 Deployment Guide</h1>
<p>HÆ°á»›ng dáº«n deploy <code>my-tiny-app</code> vÃ  <code>my-tiny-app-consumer</code> lÃªn LocalStack EC2.</p>
<h2 id="-prerequisites">ğŸ“‹ Prerequisites</h2>
<ol>
<li><strong>Docker &amp; Docker Compose</strong> - ÄÃ£ cÃ i Ä‘áº·t vÃ  Ä‘ang cháº¡y</li>
<li><strong>Terraform</strong> - Version &gt;= 1.0</li>
<li><strong>AWS CLI</strong> - Äá»ƒ kiá»ƒm tra vÃ  quáº£n lÃ½ LocalStack resources</li>
<li><strong>Make</strong> (optional) - Äá»ƒ sá»­ dá»¥ng Makefile commands</li>
</ol>
<h2 id="-quick-start">ğŸš€ Quick Start</h2>
<h3 id="1-start-localstack-vÃ -infrastructure">1. Start LocalStack vÃ  Infrastructure</h3>
<p><strong>Linux/Mac:</strong></p>
<pre><code class="language-bash">make localstack-up
</code></pre>
<p><strong>Windows (PowerShell):</strong></p>
<pre><code class="language-powershell">.\Makefile.ps1 localstack<span class="hljs-literal">-up</span>
</code></pre>
<p>Hoáº·c thá»§ cÃ´ng:</p>
<pre><code class="language-bash">docker-compose -f docker-compose.localstack.yml up -d localstack mongodb kafka zookeeper
</code></pre>
<h3 id="2-deploy-applications">2. Deploy Applications</h3>
<p><strong>Linux/Mac:</strong></p>
<pre><code class="language-bash">make deploy
</code></pre>
<p><strong>Windows (PowerShell):</strong></p>
<pre><code class="language-powershell">.\Makefile.ps1 deploy
</code></pre>
<p>Hoáº·c thá»§ cÃ´ng:</p>
<p><strong>Linux/Mac:</strong></p>
<pre><code class="language-bash">bash scripts/deploy-to-localstack.sh
</code></pre>
<p><strong>Windows (PowerShell):</strong></p>
<pre><code class="language-powershell">.\scripts\<span class="hljs-built_in">deploy-to</span><span class="hljs-literal">-localstack</span>.ps1
</code></pre>
<h2 id="-project-structure">ğŸ“ Project Structure</h2>
<pre><code>.
â”œâ”€â”€ docker-compose.localstack.yml  # LocalStack vÃ  infrastructure services
â”œâ”€â”€ terraform/
â”‚   â””â”€â”€ localstack/
â”‚       â”œâ”€â”€ main.tf               # Terraform configuration
â”‚       â”œâ”€â”€ variables.tf          # Variables
â”‚       â””â”€â”€ outputs.tf            # Outputs
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deploy-to-localstack.sh   # Deployment script (Linux/Mac)
â”‚   â”œâ”€â”€ deploy-to-localstack.ps1  # Deployment script (Windows)
â”‚   â””â”€â”€ destroy-localstack.sh    # Cleanup script
â””â”€â”€ Makefile                      # Make commands
</code></pre>
<h2 id="-configuration">ğŸ”§ Configuration</h2>
<h3 id="environment-variables">Environment Variables</h3>
<p>CÃ¡c biáº¿n mÃ´i trÆ°á»ng cÃ³ thá»ƒ Ä‘Æ°á»£c cáº¥u hÃ¬nh trong <code>terraform/localstack/variables.tf</code>:</p>
<ul>
<li><code>docker_registry</code>: Docker registry URL (máº·c Ä‘á»‹nh: &quot;localhost&quot;)</li>
<li><code>mongodb_uri</code>: MongoDB connection URI</li>
<li><code>kafka_broker</code>: Kafka broker address</li>
<li><code>app_api_url</code>: API URL cho consumer</li>
</ul>
<h3 id="localstack-endpoint">LocalStack Endpoint</h3>
<p>LocalStack cháº¡y trÃªn port <code>4566</code>. Táº¥t cáº£ AWS API calls sáº½ Ä‘Æ°á»£c route tá»›i:</p>
<pre><code>http://localhost:4566
</code></pre>
<h2 id="-architecture">ğŸ“Š Architecture</h2>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           LocalStack (AWS Services)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  EC2 Instance (my-tiny-app)             â”‚   â”‚
â”‚  â”‚  - Runs Docker container                â”‚   â”‚
â”‚  â”‚  - Port: 3000                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  EC2 Instance (my-tiny-app-consumer)     â”‚   â”‚
â”‚  â”‚  - Runs Docker container                â”‚   â”‚
â”‚  â”‚  - Port: 3001                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Infrastructure Services                  â”‚
â”‚  - MongoDB (Port: 27017)                        â”‚
â”‚  - Kafka (Port: 9092/9093)                      â”‚
â”‚  - Zookeeper (Port: 2181)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 id="ï¸-available-commands">ğŸ› ï¸ Available Commands</h2>
<h3 id="make-commands-linuxmac">Make Commands (Linux/Mac)</h3>
<pre><code class="language-bash">make <span class="hljs-built_in">help</span>              <span class="hljs-comment"># Hiá»ƒn thá»‹ táº¥t cáº£ commands</span>
make localstack-up     <span class="hljs-comment"># Start LocalStack vÃ  services</span>
make localstack-down   <span class="hljs-comment"># Stop LocalStack vÃ  services</span>
make build             <span class="hljs-comment"># Build Docker images</span>
make deploy            <span class="hljs-comment"># Deploy to LocalStack EC2</span>
make destroy           <span class="hljs-comment"># Destroy infrastructure</span>
make clean             <span class="hljs-comment"># Clean up táº¥t cáº£</span>
make test-localstack   <span class="hljs-comment"># Test LocalStack connectivity</span>
make list-instances    <span class="hljs-comment"># List EC2 instances</span>
</code></pre>
<h3 id="powershell-commands-windows">PowerShell Commands (Windows)</h3>
<pre><code class="language-powershell">.\Makefile.ps1 help              <span class="hljs-comment"># Hiá»ƒn thá»‹ táº¥t cáº£ commands</span>
.\Makefile.ps1 localstack<span class="hljs-literal">-up</span>     <span class="hljs-comment"># Start LocalStack vÃ  services</span>
.\Makefile.ps1 localstack<span class="hljs-literal">-down</span>   <span class="hljs-comment"># Stop LocalStack vÃ  services</span>
.\Makefile.ps1 build             <span class="hljs-comment"># Build Docker images</span>
.\Makefile.ps1 deploy             <span class="hljs-comment"># Deploy to LocalStack EC2</span>
.\Makefile.ps1 destroy            <span class="hljs-comment"># Destroy infrastructure</span>
.\Makefile.ps1 clean              <span class="hljs-comment"># Clean up táº¥t cáº£</span>
.\Makefile.ps1 <span class="hljs-built_in">test-localstack</span>    <span class="hljs-comment"># Test LocalStack connectivity</span>
.\Makefile.ps1 list<span class="hljs-literal">-instances</span>     <span class="hljs-comment"># List EC2 instances</span>
</code></pre>
<h3 id="manual-commands">Manual Commands</h3>
<h4 id="deploy">Deploy</h4>
<pre><code class="language-bash">bash scripts/deploy-to-localstack.sh
</code></pre>
<h4 id="destroy">Destroy</h4>
<pre><code class="language-bash">bash scripts/destroy-localstack.sh
</code></pre>
<h4 id="check-localstack-health">Check LocalStack Health</h4>
<pre><code class="language-bash">curl http://localhost:4566/_localstack/health | jq .
</code></pre>
<h4 id="list-ec2-instances">List EC2 Instances</h4>
<pre><code class="language-bash">aws --endpoint-url=http://localhost:4566 ec2 describe-instances
</code></pre>
<h4 id="describe-specific-instance">Describe Specific Instance</h4>
<pre><code class="language-bash">aws --endpoint-url=http://localhost:4566 ec2 describe-instances \
  --instance-ids &lt;instance-id&gt;
</code></pre>
<h2 id="-verification">ğŸ” Verification</h2>
<h3 id="1-check-localstack-status">1. Check LocalStack Status</h3>
<pre><code class="language-bash">curl http://localhost:4566/_localstack/health
</code></pre>
<h3 id="2-list-ec2-instances">2. List EC2 Instances</h3>
<pre><code class="language-bash">make list-instances
</code></pre>
<h3 id="3-test-applications">3. Test Applications</h3>
<pre><code class="language-bash"><span class="hljs-comment"># Test API</span>
curl http://localhost:3000/api/items

<span class="hljs-comment"># Test Consumer Health</span>
curl http://localhost:3001/health
</code></pre>
<h2 id="-terraform-management">ğŸ“ Terraform Management</h2>
<h3 id="initialize">Initialize</h3>
<pre><code class="language-bash"><span class="hljs-built_in">cd</span> terraform/localstack
terraform init
</code></pre>
<h3 id="plan">Plan</h3>
<pre><code class="language-bash">terraform plan \
  -var=<span class="hljs-string">&quot;docker_registry=localhost&quot;</span> \
  -var=<span class="hljs-string">&quot;mongodb_uri=mongodb://mongodb:27017/my-tiny-app&quot;</span> \
  -var=<span class="hljs-string">&quot;kafka_broker=kafka:9093&quot;</span> \
  -var=<span class="hljs-string">&quot;app_api_url=http://app:3000&quot;</span>
</code></pre>
<h3 id="apply">Apply</h3>
<pre><code class="language-bash">terraform apply -auto-approve \
  -var=<span class="hljs-string">&quot;docker_registry=localhost&quot;</span> \
  -var=<span class="hljs-string">&quot;mongodb_uri=mongodb://mongodb:27017/my-tiny-app&quot;</span> \
  -var=<span class="hljs-string">&quot;kafka_broker=kafka:9093&quot;</span> \
  -var=<span class="hljs-string">&quot;app_api_url=http://app:3000&quot;</span>
</code></pre>
<h3 id="destroy-1">Destroy</h3>
<pre><code class="language-bash">terraform destroy -auto-approve \
  -var=<span class="hljs-string">&quot;docker_registry=localhost&quot;</span> \
  -var=<span class="hljs-string">&quot;mongodb_uri=mongodb://mongodb:27017/my-tiny-app&quot;</span> \
  -var=<span class="hljs-string">&quot;kafka_broker=kafka:9093&quot;</span> \
  -var=<span class="hljs-string">&quot;app_api_url=http://app:3000&quot;</span>
</code></pre>
<h2 id="ï¸-important-notes">âš ï¸ Important Notes</h2>
<ol>
<li>
<p><strong>LocalStack Limitations</strong>:</p>
<ul>
<li>LocalStack Community khÃ´ng há»— trá»£ Ä‘áº§y Ä‘á»§ EC2. Cáº§n LocalStack Pro Ä‘á»ƒ cÃ³ EC2 support tá»‘t hÆ¡n.</li>
<li>Hoáº·c cÃ³ thá»ƒ sá»­ dá»¥ng docker-compose Ä‘á»ƒ cháº¡y containers trá»±c tiáº¿p (nhÆ° hiá»‡n táº¡i).</li>
</ul>
</li>
<li>
<p><strong>AMI IDs</strong>:</p>
<ul>
<li>LocalStack sá»­ dá»¥ng dummy AMI IDs. CÃ³ thá»ƒ sá»­ dá»¥ng báº¥t ká»³ AMI ID nÃ o (vÃ­ dá»¥: <code>ami-12345678</code>).</li>
</ul>
</li>
<li>
<p><strong>Network Configuration</strong>:</p>
<ul>
<li>EC2 instances trong LocalStack cÃ³ thá»ƒ khÃ´ng cÃ³ public IP thá»±c sá»±.</li>
<li>Sá»­ dá»¥ng docker-compose network Ä‘á»ƒ káº¿t ná»‘i giá»¯a cÃ¡c services.</li>
</ul>
</li>
<li>
<p><strong>Alternative Approach</strong>:</p>
<ul>
<li>Náº¿u LocalStack EC2 khÃ´ng hoáº¡t Ä‘á»™ng tá»‘t, cÃ³ thá»ƒ sá»­ dá»¥ng docker-compose Ä‘á»ƒ cháº¡y containers nhÆ° &quot;EC2 instances&quot; vÃ  chá»‰ dÃ¹ng LocalStack cho cÃ¡c AWS services khÃ¡c (S3, SQS, etc.).</li>
</ul>
</li>
</ol>
<h2 id="-alternative-docker-compose-only">ğŸ”„ Alternative: Docker Compose Only</h2>
<p>Náº¿u LocalStack EC2 khÃ´ng Ä‘Ã¡p á»©ng nhu cáº§u, cÃ³ thá»ƒ cháº¡y trá»±c tiáº¿p báº±ng docker-compose:</p>
<pre><code class="language-bash">docker-compose -f docker-compose.localstack.yml up -d
</code></pre>
<p>Äiá»u nÃ y sáº½ cháº¡y apps nhÆ° containers thÃ´ng thÆ°á»ng, nhÆ°ng váº«n cÃ³ LocalStack cho cÃ¡c AWS services khÃ¡c.</p>
<h2 id="-troubleshooting">ğŸ› Troubleshooting</h2>
<h3 id="localstack-khÃ´ng-start">LocalStack khÃ´ng start</h3>
<pre><code class="language-bash"><span class="hljs-comment"># Check logs</span>
docker-compose -f docker-compose.localstack.yml logs localstack

<span class="hljs-comment"># Restart</span>
docker-compose -f docker-compose.localstack.yml restart localstack
</code></pre>
<h3 id="terraform-errors">Terraform errors</h3>
<pre><code class="language-bash"><span class="hljs-comment"># Check Terraform state</span>
<span class="hljs-built_in">cd</span> terraform/localstack
terraform show

<span class="hljs-comment"># Remove and reinitialize if needed</span>
<span class="hljs-built_in">rm</span> -rf .terraform terraform.tfstate
terraform init
</code></pre>
<h3 id="applications-khÃ´ng-connect-Ä‘Æ°á»£c">Applications khÃ´ng connect Ä‘Æ°á»£c</h3>
<pre><code class="language-bash"><span class="hljs-comment"># Check network</span>
docker network <span class="hljs-built_in">ls</span>
docker network inspect my-mern-tiny-app-localstack_app-network

<span class="hljs-comment"># Check container logs</span>
docker logs my-tiny-app
docker logs my-tiny-app-consumer
</code></pre>
<h2 id="-resources">ğŸ“š Resources</h2>
<ul>
<li><a href="https://docs.localstack.cloud/">LocalStack Documentation</a></li>
<li><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs">Terraform AWS Provider</a></li>
<li><a href="https://docs.docker.com/compose/">Docker Compose Documentation</a></li>
</ul>

            
            
        </body>
        </html>